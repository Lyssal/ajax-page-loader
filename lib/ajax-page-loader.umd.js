!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.AjaxPageLoader=t():e.AjaxPageLoader=t()}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var o in n)e.o(n,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:n[o]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var t={};e.d(t,{default:()=>u});class n{constructor(t){this.element=t,this.layer=e.g.document.createElement("div"),this.layer.classList.add(r.cssClass)}start(){this.intLayerStyles(),this.element.insertAdjacentHTML("beforeend",this.layer.outerHTML)}stop(){this.layer.remove()}intLayerStyles(){this.initLayerStyleTop(),this.initLayerStyleLeft(),this.layer.style.height=`${this.element.offsetHeight}px`,this.layer.style.width=`${this.element.offsetWidth}px`}initLayerStyleTop(){const e=this.element.offsetTop;this.layer.style.top=`${e}px`}initLayerStyleLeft(){const e=this.element.offsetLeft;this.layer.style.left=`${e}px`}}class o{constructor(e,t=!1){void 0!==e&&(this.setSelector(e),t&&this.start())}setSelector(t){this.elements=[],t.constructor===String?Object.values(e.g.document.querySelectorAll(t)).forEach((e=>{this.elements.push(new n(e))})):t instanceof e.g.Element?this.elements.push(new n(t)):t instanceof e.g.NodeList&&Object.values(t).forEach((e=>{this.elements.push(new n(e))}))}start(){Object.values(this.elements).forEach((e=>{e.start()}))}stop(){Object.values(this.elements).forEach((e=>{e.stop()}))}}o.cssClass="lyssal-blinking-layer";const r=o;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(r=o.key,i=void 0,i=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(r,"string"),"symbol"===a(i)?i:String(i)),o)}var r,i}var s=function(){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.element=e,this.formRedirectUrl=null,this.pageLoader=n,this.ajaxLoader=null,this.initClickEvent(),this.element.dataset.pageLoaderInit="true"}var n,o,a;return n=t,o=[{key:"initClickEvent",value:function(){var e=this,t=void 0!==this.element.context?this.element.context.onclick:null;null!==t&&(this.element.removeEventListener("click",t,!0),this.element.removeAttribute("onclick")),this.element.addEventListener("click",(function(n){null===t||t()?(e.click(),n.preventDefault()):n.preventDefault()}))}},{key:"click",value:function(){var n=this,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r=this.getUrl();if(null!=r){var a=this.getTargetElement(),i={mode:"cors",redirect:"follow",credentials:"same-origin",headers:{"X-Requested-With":"Fetch"}},s=!1;if(!this.isLink()){var l,c=this.getForm();if(null!==c){if(s=!0,l=t.getElementAttribute(c,"method","post"),this.processEvent("data-before-form-submitting",this.pageLoader.beforeFormSubmittingEvent),"get"!==l){var u=new e.g.window.FormData(c);i.body=u,i.contentType=!1,i.processData=!1}var f=this.getAttribute("name");null!==f&&("get"===l?i.data+="&".concat(encodeURI(f),"=").concat(encodeURI(this.element.value)):i.body.append(f,this.element.value))}else l=this.getAttribute("data-method",this.pageLoader.defaultMethod).toLowerCase();i.method=l}null!==a&&""!==a&&this.displayLoading(a);var h=this.getAttribute("data-redirect-url");return this.processEvent("data-before-ajax-loading",this.pageLoader.beforeAjaxLoadingEvent),e.g.fetch(r,i).then((function(e){if(!e.ok)throw console.error(e),Error(e);return n.formRedirectUrl=e.redirected?e.url:null,e.text()})).then((function(r){if(null===h?n.updateAjaxContent(r):e.g.fetch(h,{mode:"cors",credentials:"same-origin",method:"get",headers:{"X-Requested-With":"Fetch"}}).then((function(e){if(!e.ok)throw console.error(e),Error(e);return e.text()})).then((function(e){n.updateAjaxContent(e),n.finalizeAjaxProcess(s)})).catch((function(e){n.hideLoading(),console.error(e)})),o){var a=n.getAttribute("data-refresh-target");if(null!==a){var i=e.g.document.querySelectorAll(a);Object.values(i).forEach((function(e){new t(e,n.pageLoader).click(!1)}))}}null===h&&n.finalizeAjaxProcess(s)})).catch((function(e){n.hideLoading(),console.error(e)})),!1}return console.error("The element URL has not be found for the AJAX page loader.",this.element),!0}},{key:"updateAjaxContent",value:function(e){var t=this.getTargetElement();this.processEvent("data-before-content-setting",this.pageLoader.beforeContentSettingEvent),null!==t&&""!==t&&(t.innerHTML=e),this.pageLoader.setSelector(this.pageLoader.selector),this.processEvent("data-after-content-setting",this.pageLoader.afterContentSettingEvent)}},{key:"processEvent",value:function(e,t){if(this.eventsAreActivate()){var n=this.getAttribute(e,t);null!==n&&("function"!=typeof n?"function"===this.eval("typeof ".concat(n))&&this.eval("".concat(n,"(element)")):n(this))}}},{key:"finalizeAjaxProcess",value:function(e){this.hideLoading(),e&&this.processEvent("data-after-form-submitting",this.pageLoader.afterFormSubmittingEvent),this.processEvent("data-after-ajax-loading",this.pageLoader.afterAjaxLoadingEvent)}},{key:"eventsAreActivate",value:function(){return"false"!==this.getAttribute("data-ajax-events")}},{key:"getTargetElement",value:function(){var t=this.getAttribute("data-target");return null!==t?e.g.document.querySelector(t):this.pageLoader.defaultTarget}},{key:"getUrl",value:function(){var n=this.getAttribute("data-url");if(null!==n)return n;if(this.element.hasAttribute("href"))return this.getAttribute("href");var o=this.getForm();return null!==o&&(n=null!==this.formRedirectUrl?this.formRedirectUrl:o.hasAttribute("action")?o.getAttribute("action"):e.g.window.location.href,"get"===t.getElementAttribute(o,"method","post").toLowerCase()&&(n+="?".concat(t.serializeFormGet(o)))),n}},{key:"isLink",value:function(){return null!==this.element.getAttribute("href")}},{key:"getAttribute",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return t.getElementAttribute(this.element,e,n)}},{key:"getForm",value:function(){return this.element.closest("form")}},{key:"displayLoading",value:function(e){return null!==this.pageLoader.loadingType&&"blinking"===this.pageLoader.loadingType&&(this.ajaxLoader=new r(e),this.ajaxLoader.start()),null}},{key:"hideLoading",value:function(){null!==this.pageLoader.loadingType&&null!==this.ajaxLoader&&"blinking"===this.pageLoader.loadingType&&this.ajaxLoader.stop()}}],a=[{key:"getElementAttribute",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return e.hasAttribute(t)?e.getAttribute(t):n}},{key:"serializeFormGet",value:function(e){if(!e||"form"!==e.nodeName.toLowerCase())return"";for(var t=[],n=e.elements.length-1;n>=0;n-=1)if(""!==e.elements[n].name)switch(e.elements[n].nodeName.toLowerCase()){case"input":switch(e.elements[n].type.toLowerCase()){case"checkbox":case"radio":e.elements[n].checked&&t.push("".concat(e.elements[n].name,"=").concat(encodeURIComponent(e.elements[n].value)));break;case"file":break;case"button":case"color":case"date":case"datetime-local":case"email":case"hidden":case"month":case"number":case"password":case"range":case"reset":case"search":case"submit":case"tel":case"text":case"time":case"url":case"week":t.push("".concat(e.elements[n].name,"=").concat(encodeURIComponent(e.elements[n].value)))}break;case"textarea":t.push("".concat(e.elements[n].name,"=").concat(encodeURIComponent(e.elements[n].value)));break;case"select":switch(e.elements[n].type.toLowerCase()){case"select-one":t.push("".concat(e.elements[n].name,"=").concat(encodeURIComponent(e.elements[n].value)));break;case"select-multiple":for(var o=e.elements[n].options.length-1;o>=0;o-=1)e.elements[n].options[o].selected&&t.push("".concat(e.elements[n].name,"=").concat(encodeURIComponent(e.elements[n].options[o].value)))}break;case"button":switch(e.elements[n].type.toLowerCase()){case"reset":case"submit":case"button":t.push("".concat(e.elements[n].name,"=").concat(encodeURIComponent(e.elements[n].value)))}}return t.join("&")}}],o&&i(n.prototype,o),a&&i(n,a),Object.defineProperty(n,"prototype",{writable:!1}),t}();function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function c(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(r=o.key,a=void 0,a=function(e,t){if("object"!==l(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!==l(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(r,"string"),"symbol"===l(a)?a:String(a)),o)}var r,a}const u=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'a[data-ajax="true"], input[type="submit"][data-ajax="true"], button[type="submit"][data-ajax="true"]';!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.elements=[],this.setSelector(e),this.setDefaultTarget("body"),this.setLoadingType("blinking"),this.defaultMethod="GET",this.beforeFormSubmittingEvent=null,this.afterFormSubmittingEvent=null,this.beforeAjaxLoadingEvent=null,this.afterAjaxLoadingEvent=null,this.beforeContentSettingEvent=null,this.afterContentSettingEvent=null}var n,o,r;return n=t,(o=[{key:"setSelector",value:function(t){var n=this;this.selector=t,Object.values(e.g.document.querySelectorAll(t)).forEach((function(e){"true"!==e.dataset.pageLoaderInit&&n.elements.push(new s(e,n))}))}},{key:"setDefaultTarget",value:function(t){t.constructor===String?this.defaultTarget=e.g.document.querySelector(t):this.defaultTarget=t}},{key:"setLoadingType",value:function(e){this.loadingType=e}},{key:"setBeforeFormSubmittingEvent",value:function(e){this.beforeFormSubmittingEvent=e}},{key:"setAfterFormSubmittingEvent",value:function(e){this.afterFormSubmittingEvent=e}},{key:"setBeforeAjaxLoadingEvent",value:function(e){this.beforeAjaxLoadingEvent=e}},{key:"setAfterAjaxLoadingEvent",value:function(e){this.afterAjaxLoadingEvent=e}},{key:"setBeforeContentSettingEvent",value:function(e){this.beforeContentSettingEvent=e}},{key:"setAfterContentSettingEvent",value:function(e){this.afterContentSettingEvent=e}}])&&c(n.prototype,o),r&&c(n,r),Object.defineProperty(n,"prototype",{writable:!1}),t}();return t=t.default})()));